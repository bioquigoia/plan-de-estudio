<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Plan Bioqu칤mica Interactivo</title>
  <style>
    body { font-family: sans-serif; padding: 20px; background: #fefefe; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    th { background: #e0e0e0; }
    td.course { cursor: pointer; transition: 0.3s; }
    td.completed { background-color: #b2f2bb; } /* verde pastel */
    td.available { background-color: #a5d8ff; } /* celeste pastel */
    td.locked { background-color: #fbb1bd; color: #888; } /* rosa pastel */
    #progress-container { width: 100%; background: #ddd; border-radius: 5px; overflow: hidden; margin-top: 20px; }
    #progress-bar { height: 20px; width: 0; background: #69db7c; transition: width 0.5s; }
    #progress-text { text-align: center; margin-top: 5px; }
    #final-message { font-size: 2em; color: #5f3dc4; text-align: center; display: none; margin-top: 20px; }
    canvas#confetti-canvas { position: fixed; top:0; left:0; width:100%; height:100%; pointer-events: none; z-index: 1000; }
  </style>
</head>
<body>
  <h1>Plan Bioqu칤mica Interactivo</h1>
  <div id="progress-container">
    <div id="progress-bar"></div>
  </div>
  <div id="progress-text">0%</div>
  <div id="final-message">춰춰춰TE RECIBISTE!!! 游꿉游꿀</div>
  <canvas id="confetti-canvas"></canvas>
  <table id="malla-table">
    <thead>
      <tr id="years-row"></tr>
      <tr id="semesters-row"></tr>
    </thead>
    <tbody id="courses-body"></tbody>
  </table>

<script>
if (!localStorage.getItem("mallaData")) {
  localStorage.setItem("mallaData", JSON.stringify([
    // A칌OS, CUATRIMESTRES Y TODA LA MALLA
    {
      year: 1,
      name: "A침o 1 (CBC)",
      semesters: [
        {
          name: "1er Cuatrimestre",
          courses: [
            { id: "matematica", name: "Matematica", requires: [] },
            { id: "quimica", name: "Quimica", requires: [] },
            { id: "sociedad_estado", name: "Sociedad y Estado", requires: [] }
          ]
        },
        {
          name: "2do Cuatrimestre",
          courses: [
            { id: "ipc", name: "IPC", requires: [] },
            { id: "biologia", name: "Biolog칤a", requires: [] },
            { id: "biofisica", name: "Biof칤sica", requires: [] }
          ]
        }
      ]
    },
    // 
    {
      year: 2,
      name: "A침o 2 (Ciclo Com칰n)",
      semesters: [
        {
          name: "1er Cuatrimestre",
          courses: [
            { id: "Quimica Inorg치nica", name: "Quimica Inorg치nica", requires: [A침o 1] },
            { id: "Matematica", name: "Matematica", requires: [A침o 1] },
            { id: "Anatomia e Histolog칤a", name: "Anatom칤a e Histolog칤a", requires: [A침o 1] }
          ]
        },
        {
          name: "2do Cuatrimestre",
          courses: [
            { id: "Fisica", name: "Fisica", requires: [Matematica] },
            { id: "biologia", name: "Biolog칤a celular y Molecular", requires: [Anatom칤a e Histologia] },
            { id: "Quimica Organica 1", name: "Qu칤mica Org치nica 1", requires: [Quimica Inorg치nica] }
 ]
        }
      ]
    },
    // 
    {
      year: 3,
      name: "A침o 3 (Ciclo Com칰n)",
      semesters: [
        {
          name: "1er Cuatrimestre",
          courses: [
            { id: "Quimica Org치nica 2", name: "Quimica Org치nica 2", requires: [Fisica y Quimica Org치nica 1] },
            { id: "Fisiolog칤a", name: "Fisiolog칤a", requires: [Anatomia e Histolog칤a y Biolog칤a celular y molecular] },
            { id: "Quimica Anal칤tica", name: "Quimica Anal칤tica", requires: [Quimica Inorg치nica y Matematica] }
          ]
        },
        {
          name: "2do Cuatrimestre",
          courses: [
            { id: "Fisicoqu칤mica", name: "Fisicoqu칤mica", requires: [Quimica Inorg치nica y Fisica] },
            { id: "Quimica Instrumental", name: "Quimica Industrial", requires: [Fisica y Quimica Analitica] },
            { id: "Quimica Biologica", name: "Quimica Biologica", requires: [Biologia celular y molecular y Quimica Org치nica 2] }
]
        }
      ]
    },
    // 
    




{
      Year: 4 ,
      name: "A침o 4 (Ciclo Superior)",
      semesters: [
        {
          name: "1er Cuatrimestre",
          courses: [
            { id: "Quimica Org치nica 2", name: "Quimica Org치nica 2", requires: [Fisica y Quimica Org치nica 1] },
            { id: "Fisiolog칤a", name: "Fisiolog칤a", requires: [Anatomia e Histolog칤a y Biolog칤a celular y molecular] },
            { id: "Quimica Anal칤tica", name: "Quimica Anal칤tica", requires: [Quimica Inorg치nica y Matematica] }
          ]
        },
        {
          name: "2do Cuatrimestre",
          courses: [
            { id: "Fisicoqu칤mica", name: "Fisicoqu칤mica", requires: [Quimica Inorg치nica y Fisica] },
            { id: "Quimica Instrumental", name: "Quimica Industrial", requires: [Fisica y Quimica Analitica] },
            { id: "Quimica Biologica", name: "Quimica Biologica", requires: [Biologia celular y molecular y Quimica Org치nica 2] }


 




   // 
  ]));
}

const confettiCanvas = document.getElementById('confetti-canvas');
const confetti = confettiCanvas.getContext('2d');
let confettiPieces = [];

function buildMalla() {
  const data = JSON.parse(localStorage.getItem("mallaData"));
  const completedCourses = JSON.parse(localStorage.getItem("completedCourses") || "[]");
  const yearsRow = document.getElementById("years-row");
  const semestersRow = document.getElementById("semesters-row");
  const coursesBody = document.getElementById("courses-body");

  yearsRow.innerHTML = "";
  semestersRow.innerHTML = "";
  coursesBody.innerHTML = "";

  data.forEach(yearData => {
    const yearCell = document.createElement("th");
    yearCell.colSpan = yearData.semesters.length;
    yearCell.textContent = yearData.name;
    yearsRow.appendChild(yearCell);

    yearData.semesters.forEach(semester => {
      const semesterCell = document.createElement("th");
      semesterCell.textContent = semester.name;
      semestersRow.appendChild(semesterCell);
    });
  });

  let maxCourses = Math.max(...data.map(y => Math.max(...y.semesters.map(s => s.courses.length))));

  for (let i = 0; i < maxCourses; i++) {
    const row = document.createElement("tr");
    data.forEach(year => {
      year.semesters.forEach(semester => {
        const course = semester.courses[i];
        const td = document.createElement("td");
        td.classList.add("course");
        if (course) {
          if (completedCourses.includes(course.id)) {
            td.classList.add("completed");
          } else if (isCourseAvailable(course, completedCourses, year, data)) {
            td.classList.add("available");
          } else {
            td.classList.add("locked");
          }
          td.textContent = course.name;
          td.addEventListener("click", () => toggleCourse(course, td));
        }
        row.appendChild(td);
      });
    });
    coursesBody.appendChild(row);
  }
  updateProgress();
}

function isCourseAvailable(course, completedCourses, yearData, allData) {
  if (course.requiresYearCompleted) {
    const prevYear = allData.find(y => y.year === course.requiresYearCompleted);
    return prevYear && prevYear.semesters.every(s =>
      s.courses.every(c => completedCourses.includes(c.id))
    );
  }
  return course.requires.every(r => completedCourses.includes(r));
}

function toggleCourse(course, td) {
  const completedCourses = JSON.parse(localStorage.getItem("completedCourses") || "[]");
  if (completedCourses.includes(course.id)) {
    const idx = completedCourses.indexOf(course.id);
    completedCourses.splice(idx,1);
  } else {
    completedCourses.push(course.id);
  }
  localStorage.setItem("completedCourses", JSON.stringify(completedCourses));
  buildMalla();
  celebrateIfNeeded();
}

function updateProgress() {
  const data = JSON.parse(localStorage.getItem("mallaData"));
  const completedCourses = JSON.parse(localStorage.getItem("completedCourses") || "[]");
  const totalCourses = data.reduce((sum, y) =>
    sum + y.semesters.reduce((s, sem) => s + sem.courses.length,0),0);
  const percent = Math.round((completedCourses.length / totalCourses) * 100);
  document.getElementById("progress-bar").style.width = percent + "%";
  document.getElementById("progress-text").textContent = percent + "%";
  if (percent === 100) showGraduation();
}

function celebrateIfNeeded() {
  const data = JSON.parse(localStorage.getItem("mallaData"));
  const completedCourses = JSON.parse(localStorage.getItem("completedCourses") || "[]");
  data.forEach(year => {
    const allDone = year.semesters.every(s =>
      s.courses.every(c => completedCourses.includes(c.id)));
    if (allDone && !localStorage.getItem("celebrated" + year.year)) {
      launchConfetti();
      localStorage.setItem("celebrated" + year.year, "yes");
    }
  });
}

function showGraduation() {
  document.getElementById("final-message").style.display = "block";
  launchConfetti(true);
}

function launchConfetti(big) {
  for (let i = 0; i < (big ? 300 : 100); i++) {
    confettiPieces.push({
      x: Math.random() * window.innerWidth,
      y: Math.random() * -20,
      size: Math.random() * 8 + 2,
      speed: Math.random() * 3 + 2,
      color: `hsl(${Math.random() * 360}, 100%, 70%)`
    });
  }
}

function animateConfetti() {
  confetti.clearRect(0,0,confettiCanvas.width, confettiCanvas.height);
  confetti.fillStyle = "rgba(255,255,255,0.5)";
  confettiPieces.forEach(p => {
    confetti.fillStyle = p.color;
    confetti.fillRect(p.x, p.y, p.size, p.size);
    p.y += p.speed;
    if (p.y > window.innerHeight) {
      p.y = Math.random() * -20;
      p.x = Math.random() * window.innerWidth;
    }
  });
  requestAnimationFrame(animateConfetti);
}

window.onload = () => {
  confettiCanvas.width = window.innerWidth;
  confettiCanvas.height = window.innerHeight;
  buildMalla();
  animateConfetti();
};
</script>
</body>
</html>
